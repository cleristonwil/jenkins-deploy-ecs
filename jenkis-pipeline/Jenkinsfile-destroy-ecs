pipeline {
    agent any
    
    environment {
        // Diret칩rio onde est칚o os arquivos Terraform (relativo ao workspace do Jenkins)
        TERRAFORM_DIR = "terraform-ecs"
        // Diret칩rio dos m칩dulos Terraform (relativo ao workspace do Jenkins)
        TERRAFORM_DIR_MODULE = "terraform-ecs/modules"
    }

    stages {
        stage('Terraform validate') {
            steps {
                // Verifica se o Terraform est치 instalado e mostra a vers칚o
                sh 'terraform --version'
            }
        }
        
        stage('Terraform Destroy') {
            steps {
                script {
                    // 丘멆잺  ATEN칂츾O: Este comando DESTROI todos os recursos criados pelo Terraform
                    // Isso inclui: ECS Cluster, Task Definitions, Services, Load Balancers, etc.
                    // O '-auto-approve' pula a confirma칞칚o manual
                    // 游눯 Isso pode ajudar a evitar custos desnecess치rios na AWS
                    sh "bash -c 'cd ${env.TERRAFORM_DIR} && terraform destroy -auto-approve'"
                }
            }
        }
    }
}
